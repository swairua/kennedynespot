# Netlify configuration for performance optimization
# Sets proper cache headers for different asset types

[build]
  command = "npm run build"
  publish = "dist"

# Set cache headers for different asset types
[[headers]]
  # HTML files - no cache to always serve latest
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "SAMEORIGIN"
    X-XSS-Protection = "1; mode=block"

[[headers]]
  # JavaScript and CSS with hash in filename - cache long term
  for = "/*.[a-f0-9]*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  # CSS files with hash - cache long term
  for = "/*.[a-f0-9]*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  # Images with hash - cache long term
  for = "/*.[a-f0-9]*.{jpg,jpeg,png,gif,webp,svg}"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  # Fonts - cache long term
  for = "/fonts/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    Access-Control-Allow-Origin = "*"

[[headers]]
  # JSON data files - shorter cache
  for = "/*.json"
  [headers.values]
    Cache-Control = "public, max-age=3600"

[[headers]]
  # Default - cache for 1 hour
  for = "/*"
  [headers.values]
    Cache-Control = "public, max-age=3600"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "SAMEORIGIN"

# Redirect trailing slashes
[[redirects]]
  from = "/:path/*"
  to = "/:path"
  status = 301
  force = false

# Blog posts - serve static files with OG tags
[[redirects]]
  from = "/blog/:slug/index.html"
  to = "/blog/:slug/index.html"
  status = 200
  force = false

# SPA routing - redirect 404s to index.html (must be last)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
